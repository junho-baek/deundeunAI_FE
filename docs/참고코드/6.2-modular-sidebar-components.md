# 6.2 Modular Sidebar Components

## 개요

이 문서는 사이드바를 모듈화된 컴포넌트로 구성하는 패턴을 설명합니다. 단일 컴포넌트에 모든 로직을 넣는 대신, 기능별로 분리된 컴포넌트를 조합하여 유지보수성과 재사용성을 높입니다.

## 주요 패턴

### 1. 컴포넌트 분리 전략

사이드바를 다음과 같이 기능별로 분리합니다:

- **`SidebarMain`**: 메인 네비게이션 메뉴 (Collapsible 서브메뉴 포함)
- **`SidebarProjects`**: 프로젝트 목록 (드롭다운 액션 포함)
- **`SidebarUser`**: 사용자 정보 및 설정 메뉴
- **`SidebarTeamSwitcher`**: 팀 전환 기능
- **`DashboardSidebar`**: 전체 사이드바를 조합하는 컨테이너 컴포넌트

### 2. SidebarMain 컴포넌트

**파일: `app/features/users/components/sidebar-main.tsx`**

```typescript
import { ChevronRight, type LucideIcon } from "lucide-react";
import { Link } from "react-router";
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from "~/core/components/ui/collapsible";
import {
  SidebarGroup,
  SidebarGroupLabel,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
} from "~/core/components/ui/sidebar";

export default function SidebarMain({
  items,
}: {
  items: {
    title: string;
    url: string;
    icon?: LucideIcon;
    isActive?: boolean;
    items?: {
      title: string;
      url: string;
    }[];
  }[];
}) {
  return (
    <SidebarGroup>
      <SidebarGroupLabel>Platform</SidebarGroupLabel>
      <SidebarMenu>
        {items.map((item) => (
          <Collapsible
            key={item.title}
            asChild
            defaultOpen={item.isActive}
            className="group/collapsible"
          >
            <SidebarMenuItem>
              <CollapsibleTrigger asChild>
                <SidebarMenuButton tooltip={item.title}>
                  {item.icon && <item.icon />}
                  <span>{item.title}</span>
                  <ChevronRight className="ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90" />
                </SidebarMenuButton>
              </CollapsibleTrigger>
              <CollapsibleContent>
                <SidebarMenuSub>
                  {item.items?.map((subItem) => (
                    <SidebarMenuSubItem key={subItem.title}>
                      <SidebarMenuSubButton asChild>
                        <Link to={subItem.url}>
                          <span>{subItem.title}</span>
                        </Link>
                      </SidebarMenuSubButton>
                    </SidebarMenuSubItem>
                  ))}
                </SidebarMenuSub>
              </CollapsibleContent>
            </SidebarMenuItem>
          </Collapsible>
        ))}
      </SidebarMenu>
    </SidebarGroup>
  );
}
```

**핵심 포인트:**

- **Collapsible 패턴**: 접을 수 있는 서브메뉴 구현
- **`defaultOpen={item.isActive}`**: 활성 메뉴는 기본적으로 열림
- **아이콘 회전 애니메이션**: `group-data-[state=open]/collapsible:rotate-90`로 화살표 회전
- **타입 안전성**: `LucideIcon` 타입으로 아이콘 타입 체크

### 3. SidebarProjects 컴포넌트

**파일: `app/features/users/components/sidebar-projects.tsx`**

```typescript
import {
  Folder,
  Forward,
  type LucideIcon,
  MoreHorizontal,
  Trash2,
} from "lucide-react";
import { Link } from "react-router";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "~/core/components/ui/dropdown-menu";
import {
  SidebarGroup,
  SidebarGroupLabel,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuButton,
  SidebarMenuItem,
  useSidebar,
} from "~/core/components/ui/sidebar";

export default function SidebarProjects({
  projects,
}: {
  projects: {
    name: string;
    url: string;
    icon: LucideIcon;
  }[];
}) {
  const { isMobile } = useSidebar();

  return (
    <SidebarGroup className="group-data-[collapsible=icon]:hidden">
      <SidebarGroupLabel>Projects</SidebarGroupLabel>
      <SidebarMenu>
        {projects.map((item) => (
          <SidebarMenuItem key={item.name}>
            <SidebarMenuButton asChild>
              <Link to={item.url}>
                <item.icon />
                <span>{item.name}</span>
              </Link>
            </SidebarMenuButton>
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <SidebarMenuAction showOnHover>
                  <MoreHorizontal />
                  <span className="sr-only">More</span>
                </SidebarMenuAction>
              </DropdownMenuTrigger>
              <DropdownMenuContent
                className="w-48 rounded-lg"
                side={isMobile ? "bottom" : "right"}
                align={isMobile ? "end" : "start"}
              >
                <DropdownMenuItem>
                  <Folder className="text-muted-foreground" />
                  <span>View Project</span>
                </DropdownMenuItem>
                <DropdownMenuItem>
                  <Forward className="text-muted-foreground" />
                  <span>Share Project</span>
                </DropdownMenuItem>
                <DropdownMenuSeparator />
                <DropdownMenuItem>
                  <Trash2 className="text-muted-foreground" />
                  <span>Delete Project</span>
                </DropdownMenuItem>
              </DropdownMenuContent>
            </DropdownMenu>
          </SidebarMenuItem>
        ))}
        <SidebarMenuItem>
          <SidebarMenuButton className="text-sidebar-foreground/70">
            <MoreHorizontal className="text-sidebar-foreground/70" />
            <span>More</span>
          </SidebarMenuButton>
        </SidebarMenuItem>
      </SidebarMenu>
    </SidebarGroup>
  );
}
```

**핵심 포인트:**

- **`useSidebar` 훅**: 사이드바 상태(모바일 여부 등) 접근
- **`showOnHover`**: 호버 시에만 표시되는 액션 버튼
- **반응형 드롭다운**: 모바일/데스크톱에 따라 다른 위치에 표시
- **아이콘 모드 숨김**: `group-data-[collapsible=icon]:hidden`으로 아이콘 모드에서 숨김

### 4. SidebarUser 컴포넌트

**파일: `app/features/users/components/sidebar-user.tsx`**

```typescript
import {
  BadgeCheck,
  Bell,
  ChevronsUpDown,
  CreditCard,
  LogOut,
  Sparkles,
  UserCircle2Icon,
} from "lucide-react";
import { Link } from "react-router";
import {
  Avatar,
  AvatarFallback,
  AvatarImage,
} from "~/core/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "~/core/components/ui/dropdown-menu";
import {
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  useSidebar,
} from "~/core/components/ui/sidebar";

export default function SidebarUser({
  user,
}: {
  user: {
    name: string;
    email: string;
    avatarUrl: string;
  };
}) {
  const { isMobile } = useSidebar();

  return (
    <SidebarMenu>
      <SidebarMenuItem>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <SidebarMenuButton
              size="lg"
              className="data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground"
            >
              <Avatar className="h-8 w-8 rounded-lg">
                <AvatarImage src={user.avatarUrl} alt={user.name} />
                <AvatarFallback className="rounded-lg">
                  {user.name.slice(0, 2)}
                </AvatarFallback>
              </Avatar>
              <div className="grid flex-1 text-left text-sm leading-tight">
                <span className="truncate font-semibold">{user.name}</span>
                <span className="truncate text-xs">{user.email}</span>
              </div>
              <ChevronsUpDown className="ml-auto size-4" />
            </SidebarMenuButton>
          </DropdownMenuTrigger>
          <DropdownMenuContent
            className="w-[--radix-dropdown-menu-trigger-width] min-w-56 rounded-lg"
            side={isMobile ? "bottom" : "right"}
            align="end"
            sideOffset={4}
          >
            <DropdownMenuLabel className="p-0 font-normal">
              <div className="flex items-center gap-2 px-1 py-1.5 text-left text-sm">
                <Avatar className="h-8 w-8 rounded-lg">
                  <AvatarImage src={user.avatarUrl} alt={user.name} />
                  <AvatarFallback className="rounded-lg">
                    {user.name.slice(0, 2)}
                  </AvatarFallback>
                </Avatar>
                <div className="grid flex-1 text-left text-sm leading-tight">
                  <span className="truncate font-semibold">{user.name}</span>
                  <span className="truncate text-xs">{user.email}</span>
                </div>
              </div>
            </DropdownMenuLabel>
            <DropdownMenuSeparator />
            <DropdownMenuGroup>
              <DropdownMenuItem>
                <Sparkles />
                Upgrade to Pro
              </DropdownMenuItem>
            </DropdownMenuGroup>
            <DropdownMenuSeparator />
            <DropdownMenuGroup>
              <DropdownMenuItem asChild>
                <Link to="/account/edit" viewTransition>
                  <UserCircle2Icon />
                  Account
                </Link>
              </DropdownMenuItem>
              <DropdownMenuItem asChild>
                <Link to="/dashboard/payments">
                  <CreditCard />
                  Payments
                </Link>
              </DropdownMenuItem>
              <DropdownMenuItem>
                <Bell />
                Notifications
              </DropdownMenuItem>
            </DropdownMenuGroup>
            <DropdownMenuSeparator />
            <DropdownMenuItem asChild>
              <Link to="/logout">
                <LogOut />
                Log out
              </Link>
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </SidebarMenuItem>
    </SidebarMenu>
  );
}
```

**핵심 포인트:**

- **Avatar 컴포넌트**: 사용자 프로필 이미지 및 폴백
- **`viewTransition`**: React Router의 뷰 트랜지션 지원
- **드롭다운 너비 자동 조정**: `w-[--radix-dropdown-menu-trigger-width]`로 트리거 너비에 맞춤
- **반응형 위치**: 모바일에서는 하단, 데스크톱에서는 오른쪽에 표시

### 5. SidebarTeamSwitcher 컴포넌트

**파일: `app/features/users/components/sidebar-team-switcher.tsx`**

```typescript
import { ChevronsUpDown, Plus } from "lucide-react";
import * as React from "react";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuTrigger,
} from "~/core/components/ui/dropdown-menu";
import {
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  useSidebar,
} from "~/core/components/ui/sidebar";

export default function TeamSwitcher({
  teams,
}: {
  teams: {
    name: string;
    logo: React.ElementType;
    plan: string;
  }[];
}) {
  const { isMobile } = useSidebar();
  const [activeTeam, setActiveTeam] = React.useState(teams[0]);

  if (!activeTeam) {
    return null;
  }

  return (
    <SidebarMenu>
      <SidebarMenuItem>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <SidebarMenuButton
              size="lg"
              className="data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground"
            >
              <div className="bg-sidebar-primary text-sidebar-primary-foreground flex aspect-square size-8 items-center justify-center rounded-lg">
                <activeTeam.logo className="size-4" />
              </div>
              <div className="grid flex-1 text-left text-sm leading-tight">
                <span className="truncate font-semibold">
                  {activeTeam.name}
                </span>
                <span className="truncate text-xs">{activeTeam.plan}</span>
              </div>
              <ChevronsUpDown className="ml-auto" />
            </SidebarMenuButton>
          </DropdownMenuTrigger>
          <DropdownMenuContent
            className="w-[--radix-dropdown-menu-trigger-width] min-w-56 rounded-lg"
            align="start"
            side={isMobile ? "bottom" : "right"}
            sideOffset={4}
          >
            <DropdownMenuLabel className="text-muted-foreground text-xs">
              Teams
            </DropdownMenuLabel>
            {teams.map((team, index) => (
              <DropdownMenuItem
                key={team.name}
                onClick={() => setActiveTeam(team)}
                className="gap-2 p-2"
              >
                <div className="flex size-6 items-center justify-center rounded-sm border">
                  <team.logo className="size-4 shrink-0" />
                </div>
                {team.name}
                <DropdownMenuShortcut>⌘{index + 1}</DropdownMenuShortcut>
              </DropdownMenuItem>
            ))}
            <DropdownMenuSeparator />
            <DropdownMenuItem className="gap-2 p-2">
              <div className="bg-background flex size-6 items-center justify-center rounded-md border">
                <Plus className="size-4" />
              </div>
              <div className="text-muted-foreground font-medium">Add team</div>
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </SidebarMenuItem>
    </SidebarMenu>
  );
}
```

**핵심 포인트:**

- **로컬 상태 관리**: `useState`로 활성 팀 관리
- **키보드 단축키**: `DropdownMenuShortcut`으로 ⌘1, ⌘2 등 지원
- **동적 아이콘**: `React.ElementType`으로 로고 컴포넌트 전달

### 6. DashboardSidebar 컨테이너 컴포넌트

**파일: `app/features/users/components/dashboard-sidebar.tsx`**

```typescript
import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarHeader,
  SidebarRail,
} from "~/core/components/ui/sidebar";

import SidebarMain from "./sidebar-main";
import SidebarProjects from "./sidebar-projects";
import TeamSwitcher from "./sidebar-team-switcher";
import SidebarUser from "./sidebar-user";

const data = {
  teams: [
    {
      name: "SalesForge",
      logo: BuildingIcon,
      plan: "Enterprise",
    },
    // ...
  ],
  navMain: [
    {
      title: "Dashboard",
      url: "#",
      icon: LayoutDashboardIcon,
      isActive: true,
      items: [
        {
          title: "Overview",
          url: "/dashboard",
        },
        // ...
      ],
    },
    // ...
  ],
  projects: [
    {
      name: "Sales Team",
      url: "#",
      icon: Target,
    },
    // ...
  ],
};

export default function DashboardSidebar({
  user,
  ...props
}: React.ComponentProps<typeof Sidebar> & {
  user: {
    name: string;
    email: string;
    avatarUrl: string;
  };
}) {
  return (
    <Sidebar collapsible="icon" variant="inset" {...props}>
      <SidebarHeader>
        <TeamSwitcher teams={data.teams} />
      </SidebarHeader>
      <SidebarContent>
        <SidebarMain items={data.navMain} />
        <SidebarProjects projects={data.projects} />
      </SidebarContent>
      <SidebarFooter>
        <SidebarUser
          user={{
            name: user.name,
            email: user.email,
            avatarUrl: user.avatarUrl,
          }}
        />
      </SidebarFooter>
      <SidebarRail />
    </Sidebar>
  );
}
```

**핵심 포인트:**

- **컴포지션 패턴**: 작은 컴포넌트들을 조합하여 큰 컴포넌트 구성
- **데이터 분리**: 사이드바 데이터를 별도 객체로 관리
- **Props 전달**: `{...props}`로 Sidebar의 모든 props 전달 가능
- **구조화된 레이아웃**: Header, Content, Footer로 명확한 구조

### 7. useFetcher를 사용한 비동기 작업

**파일: `app/features/users/components/connect-provider-buttons.tsx`**

```typescript
import { Form, useFetcher, useNavigation } from "react-router";

export function ConnectProviderButton({
  provider,
  logo,
  providerKey,
}: {
  provider: string;
  logo: React.ReactNode;
  providerKey: string;
}) {
  const fetcher =
    useFetcher<ConnectProviderRoute.ComponentProps["actionData"]>();
  const navigation = useNavigation();
  
  return (
    <fetcher.Form method={"post"} action={"/api/users/providers"}>
      <input type="hidden" name="provider" value={providerKey} />
      <Button
        disabled={fetcher.state === "submitting"}
        className="w-1/3 justify-between"
        variant={"outline"}
      >
        <div className="flex w-1/5 items-center gap-2">
          <span>{logo}</span>
          <span>{provider}</span>
        </div>
        <div className="inline-flex items-center justify-center gap-2">
          <span className="flex items-center gap-2 text-xs">
            {fetcher.state === "idle" && navigation.state !== "loading" ? (
              <>
                <PlugIcon className="block size-4" />
              </>
            ) : null}
            {fetcher.state !== "idle" || navigation.state !== "idle" ? (
              <Loader2Icon className="size-4 animate-spin" />
            ) : null}
          </span>
        </div>
      </Button>
    </fetcher.Form>
  );
}
```

**핵심 포인트:**

- **`useFetcher`**: 페이지 전환 없이 폼 제출
- **`fetcher.Form`**: React Router의 Form 컴포넌트
- **로딩 상태**: `fetcher.state`와 `navigation.state`로 UI 업데이트
- **타입 안전성**: 제네릭으로 actionData 타입 지정

## 적용 가이드

### 1. 컴포넌트 분리 기준

- **단일 책임 원칙**: 각 컴포넌트는 하나의 명확한 역할만 수행
- **재사용성**: 다른 사이드바에서도 사용 가능하도록 설계
- **데이터 의존성**: 필요한 데이터만 props로 전달

### 2. 상태 관리 전략

- **로컬 상태**: `useState`로 컴포넌트 내부 상태 관리 (예: 활성 팀)
- **전역 상태**: 필요시 Context API나 상태 관리 라이브러리 사용
- **서버 상태**: React Router의 `loader`와 `useLoaderData` 활용

### 3. 반응형 처리

- **`useSidebar` 훅**: 사이드바 상태(모바일 여부 등) 접근
- **조건부 렌더링**: `group-data-[collapsible=icon]:hidden` 등으로 아이콘 모드 처리
- **드롭다운 위치**: 모바일/데스크톱에 따라 다른 위치에 표시

### 4. 접근성 고려사항

- **`sr-only`**: 스크린 리더 전용 텍스트
- **키보드 네비게이션**: 드롭다운 메뉴 키보드 지원
- **ARIA 속성**: 적절한 ARIA 레이블 사용

## 장점

1. **유지보수성**: 각 컴포넌트가 독립적으로 관리 가능
2. **재사용성**: 다른 사이드바에서도 컴포넌트 재사용 가능
3. **테스트 용이성**: 작은 단위로 테스트 가능
4. **코드 가독성**: 각 컴포넌트의 역할이 명확함
5. **확장성**: 새로운 기능 추가 시 기존 코드 영향 최소화

## 주의사항

1. **Props 드릴링**: 너무 많은 props 전달 시 Context API 고려
2. **성능**: 불필요한 리렌더링 방지를 위한 `React.memo` 고려
3. **타입 안전성**: TypeScript로 props 타입 명확히 정의
4. **일관성**: 모든 컴포넌트에서 동일한 패턴 유지

## 참고

- [shadcn/ui Sidebar 문서](https://ui.shadcn.com/docs/components/sidebar)
- [React Router useFetcher 문서](https://reactrouter.com/en/main/hooks/use-fetcher)
- [Radix UI Collapsible 문서](https://www.radix-ui.com/primitives/docs/components/collapsible)

