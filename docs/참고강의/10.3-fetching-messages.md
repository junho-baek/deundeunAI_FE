# 10.3 Fetching Messages

## 커밋 요약

커밋 `73566ff`에서는 메시지 룸 목록에서 특정 룸을 클릭했을 때 실제 채팅 내용을 로드하고 렌더링하는 흐름을 완성했습니다.

1. **`messages-layout.tsx`**
   - Loader가 서버에서 `getMessages`(뷰 기반) 결과를 받아온 뒤 Outlet context로 현재 사용자 ID를 하위 라우트에 전달합니다.
   - Sidebar에서 메시지 룸 카드를 렌더링하고, `Outlet context`를 통해 메시지 페이지도 사용자 ID를 참조할 수 있게 했습니다.

2. **`message-page.tsx` Loader**
   - 새로 추가된 `getMessagesByMessagesRoomId`를 호출해 룸 멤버인지 확인하고, 메시지 리스트와 상대 프로필(avatar/name)을 함께 로딩합니다.
   - 페이지 컴포넌트는 loaderData와 Outlet context를 사용해 메시지를 표시하고, 본인 메시지 여부를 결정합니다.

3. **Queries**
   - `getMessagesByMessagesRoomId`: `message_room_members`로 접근권한을 확인한 뒤, `messages` + `profiles` 조인으로 실제 메시지를 가져옵니다.
   - `getRoomsParticipant`: 같은 룸에서 본인을 제외한 상대 프로필 정보를 조회.

4. **Context 공급**
   - `root.tsx`에서 Outlet context에 `userId`를 추가, 하위 라우트들이 따로 인증 체크 없이 현재 유저 ID를 활용할 수 있게 했습니다.
   - `routes.ts`의 메시지 라우트 파라미터 이름을 `:messageRoomId`로 변경해 일관성 유지.

## 든든 AI 적용 아이디어

- 시스템–사용자 채팅에도 “룸” 개념은 없지만, 프로젝트 워크스페이스에서 특정 스텝이나 담당자에 대한 세부 메시지를 로딩할 때 같은 패턴(Loader + 접근권한 확인)을 사용할 수 있습니다.
- 다만 현재는 단일 프로젝트/단일 채널 구조이므로, 추후 사람 간 협업용 DM을 추가할 때 이 흐름을 그대로 참고하면 됩니다.
