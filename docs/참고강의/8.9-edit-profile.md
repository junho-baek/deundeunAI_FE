# 8.9 Edit Profile

## ì»¤ë°‹ ìš”ì•½

í”„ë¡œí•„ í¸ì§‘ ê¸°ëŠ¥ì„ êµ¬í˜„í•œ ì»¤ë°‹ì…ë‹ˆë‹¤. Loaderì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ, Actionì—ì„œ Zod ê²€ì¦ ë° ì—…ë°ì´íŠ¸, Alert ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•œ ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ, useOutletContextë¥¼ í†µí•œ ì‚¬ìš©ì ì •ë³´ ì ‘ê·¼, ì¡°ê±´ë¶€ ë Œë”ë§ ë“±ì˜ íŒ¨í„´ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

## ì£¼ìš” ë³€ê²½ì‚¬í•­

### 1. Alert ì»´í¬ë„ŒíŠ¸ ì¶”ê°€

**êµ¬í˜„**:
```typescript
// app/common/components/ui/alert.tsx
const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive: "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
);

export const Alert = React.forwardRef<HTMLDivElement, ...>;
export const AlertTitle = React.forwardRef<HTMLParagraphElement, ...>;
export const AlertDescription = React.forwardRef<HTMLParagraphElement, ...>;
```

**íŒ¨í„´**:
- `cva`ë¥¼ ì‚¬ìš©í•œ variant ê¸°ë°˜ ìŠ¤íƒ€ì¼ë§
- `role="alert"`ë¡œ ì ‘ê·¼ì„± í–¥ìƒ
- `destructive` variantë¡œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ

**ì¥ì **:
- ì¼ê´€ëœ ì•Œë¦¼ UI
- ì ‘ê·¼ì„± í–¥ìƒ
- ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸

### 2. Mutationsì— í”„ë¡œí•„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì¶”ê°€

**êµ¬í˜„**:
```typescript
// app/features/users/mutations.ts
export const updateUser = async (
  client: SupabaseClient<Database>,
  {
    id,
    name,
    role,
    headline,
    bio,
  }: {
    id: string;
    name: string;
    role: "developer" | "designer" | "marketer" | "founder" | "product-manager";
    headline: string;
    bio: string;
  }
) => {
  const { error } = await client
    .from("profiles")
    .update({ name, role, headline, bio })
    .eq("profile_id", id);

  if (error) {
    throw error;
  }
};
```

**íŒ¨í„´**:
- ê°„ë‹¨í•œ update ì‘ì—…
- ì—ëŸ¬ëŠ” ê·¸ëŒ€ë¡œ throwí•˜ì—¬ ìƒìœ„ì—ì„œ ì²˜ë¦¬
- íƒ€ì… ì•ˆì •ì„± ë³´ì¥

### 3. Loaderì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ

**êµ¬í˜„**:
```typescript
// app/features/users/pages/settings-page.tsx
export const loader = async ({ request }: Route.LoaderArgs) => {
  const { client } = makeSSRClient(request);
  const userId = await getLoggedInUserId(client);
  const user = await getUserById(client, { id: userId });
  
  return { user };
};
```

**íŒ¨í„´**:
- ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
- í¼ì˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©

**ì¥ì **:
- ì„œë²„ ì‚¬ì´ë“œì—ì„œ ë°ì´í„° ì¡°íšŒ
- í¼ì— í˜„ì¬ ê°’ í‘œì‹œ

### 4. Actionì—ì„œ Zod ê²€ì¦ ë° ì—…ë°ì´íŠ¸

**êµ¬í˜„**:
```typescript
const formSchema = z.object({
  name: z.string().min(3),
  role: z.string(),
  headline: z.string().optional().default(""),
  bio: z.string().optional().default(""),
});

export const action = async ({ request }: Route.ActionArgs) => {
  const { client } = makeSSRClient(request);
  const userId = await getLoggedInUserId(client);
  
  const formData = await request.formData();
  const { success, error, data } = formSchema.safeParse(
    Object.fromEntries(formData)
  );

  if (!success) {
    return { formErrors: error.flatten().fieldErrors };
  }

  const { name, role, headline, bio } = data;
  
  await updateUser(client, {
    id: userId,
    name,
    role: role as "developer" | "designer" | "marketer" | "founder" | "product-manager",
    headline,
    bio,
  });

  return {
    ok: true,
  };
};
```

**íŒ¨í„´**:
- Zod ìŠ¤í‚¤ë§ˆë¡œ ê²€ì¦
- `optional().default("")`ë¡œ ì˜µì…”ë„ í•„ë“œ ì²˜ë¦¬
- ì—ëŸ¬ëŠ” `formErrors`ë¡œ ë°˜í™˜
- ì„±ê³µ ì‹œ `{ ok: true }` ë°˜í™˜

### 5. Alertë¥¼ í†µí•œ ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ

**êµ¬í˜„**:
```typescript
// ì„±ê³µ ë©”ì‹œì§€
{actionData?.ok ? (
  <Alert>
    <AlertTitle>Success</AlertTitle>
    <AlertDescription>
      Your profile has been updated.
    </AlertDescription>
  </Alert>
) : null}

// ì—ëŸ¬ ë©”ì‹œì§€ (í•„ë“œë³„)
{actionData?.formErrors?.name ? (
  <Alert>
    <AlertTitle>Error</AlertTitle>
    <AlertDescription>
      {actionData.formErrors.name.join(", ")}
    </AlertDescription>
  </Alert>
) : null}
```

**íŒ¨í„´**:
- ì„±ê³µ ë©”ì‹œì§€ëŠ” ìƒë‹¨ì— í‘œì‹œ
- ì—ëŸ¬ ë©”ì‹œì§€ëŠ” ê° í•„ë“œ ì•„ë˜ì— í‘œì‹œ
- Alert ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©

**ì¥ì **:
- ì¼ê´€ëœ ë©”ì‹œì§€ UI
- ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ í”¼ë“œë°±

### 6. useOutletContextë¥¼ í†µí•œ ì‚¬ìš©ì ì •ë³´ ì ‘ê·¼

**êµ¬í˜„**:
```typescript
// app/features/users/layouts/profile-layout.tsx
export default function ProfileLayout({
  loaderData,
  params,
}: Route.ComponentProps & { params: { username: string } }) {
  const { isLoggedIn, username } = useOutletContext<{
    isLoggedIn: boolean;
    username?: string;
  }>();

  return (
    <div>
      {isLoggedIn && username === params.username ? (
        <Button variant="outline" asChild>
          <Link to="/my/settings">Edit profile</Link>
        </Button>
      ) : null}
      
      {isLoggedIn && username !== params.username ? (
        <>
          <Button variant="secondary">Follow</Button>
          <Dialog>...</Dialog>
        </>
      ) : null}
    </div>
  );
}
```

**íŒ¨í„´**:
- `useOutletContext`ë¡œ ìƒìœ„ Layoutì˜ ë°ì´í„° ì ‘ê·¼
- ì¡°ê±´ë¶€ ë Œë”ë§ìœ¼ë¡œ ë²„íŠ¼ í‘œì‹œ

**ì¥ì **:
- Props drilling ë°©ì§€
- ì¡°ê±´ë¶€ UI ë Œë”ë§

### 7. SelectPair ì»´í¬ë„ŒíŠ¸ì— required, defaultValue ì¶”ê°€

**êµ¬í˜„**:
```typescript
// app/common/components/select-pair.tsx
export default function SelectPair({
  label,
  description,
  placeholder,
  options,
  defaultValue,
  required, // ì¶”ê°€
}: {
  // ...
  defaultValue?: string; // ì¶”ê°€
  required?: boolean; // ì¶”ê°€
}) {
  return (
    <Select
      name={name}
      required={required}
      defaultValue={defaultValue}
    >
      {/* ... */}
    </Select>
  );
}
```

**íŒ¨í„´**: InputPairì™€ ë™ì¼í•œ íŒ¨í„´ ì ìš©

### 8. Form í•„ë“œì— defaultValue ì„¤ì •

**êµ¬í˜„**:
```typescript
<InputPair
  label="Name"
  name="name"
  defaultValue={loaderData.user.name}
  // ...
/>

<SelectPair
  label="Role"
  name="role"
  defaultValue={loaderData.user.role}
  // ...
/>
```

**íŒ¨í„´**: Loaderì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •

**ì¥ì **: ì‚¬ìš©ìê°€ í˜„ì¬ ê°’ì„ í™•ì¸í•˜ê³  ìˆ˜ì • ê°€ëŠ¥

### 9. Queriesì— í•„ë“œ ì¶”ê°€

**êµ¬í˜„**:
```typescript
// app/features/users/queries.ts
export const getUserById = async (
  client: SupabaseClient<Database>,
  { id }: { id: string }
) => {
  const { data, error } = await client
    .from("profiles")
    .select(`
      profile_id,
      name,
      username,
      avatar,
      headline,  // ì¶”ê°€
      bio,       // ì¶”ê°€
      role       // ì¶”ê°€
    `)
    .eq("profile_id", id)
    .single();

  if (error) throw error;
  return data;
};
```

**íŒ¨í„´**: í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒí•˜ì—¬ ì¡°íšŒ

## ì ìš© ë°©ì•ˆ

### âœ… ì´ë¯¸ ì ìš©ëœ íŒ¨í„´

1. **Loader ì‚¬ìš©**: ì—¬ëŸ¬ í˜ì´ì§€ì—ì„œ ì´ë¯¸ ì‚¬ìš© ì¤‘
2. **Zod ê²€ì¦**: ì—¬ëŸ¬ í˜ì´ì§€ì—ì„œ ì‚¬ìš© ì¤‘
3. **Mutations íŒŒì¼ ë¶„ë¦¬**: ì´ë¯¸ ì ìš©ë¨
4. **Formì— `method="post"` ëª…ì‹œ**: ì¼ë¶€ Formì—ì„œ ì‚¬ìš© ì¤‘
5. **useOutletContext**: ì¼ë¶€ Layoutì—ì„œ ì‚¬ìš© ì¤‘

### ğŸ”„ ì¶”ê°€ë¡œ ì ìš© ê°€ëŠ¥í•œ íŒ¨í„´

#### 1. Alert ì»´í¬ë„ŒíŠ¸ ì¶”ê°€ (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

**í˜„ì¬ ìƒíƒœ**: Alert ì»´í¬ë„ŒíŠ¸ ì—†ìŒ

**ì ìš© ë°©ì•ˆ**: Alert ì»´í¬ë„ŒíŠ¸ ìƒì„± ë° ì‚¬ìš©

**ì ìš© ëŒ€ìƒ**:
- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
- ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
- ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ

**ì¥ì **:
- ì¼ê´€ëœ ì•Œë¦¼ UI
- ì ‘ê·¼ì„± í–¥ìƒ

#### 2. í”„ë¡œí•„ í¸ì§‘ í˜ì´ì§€ êµ¬í˜„ (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

**í˜„ì¬ ìƒíƒœ**: í”„ë¡œí•„ í¸ì§‘ í˜ì´ì§€ ì—†ìŒ

**ì ìš© ë°©ì•ˆ**:
- Loaderì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
- Actionì—ì„œ Zod ê²€ì¦ ë° ì—…ë°ì´íŠ¸
- Alertë¡œ ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
- Form í•„ë“œì— defaultValue ì„¤ì •

**ì¥ì **: ì‚¬ìš©ìê°€ í”„ë¡œí•„ì„ í¸ì§‘í•  ìˆ˜ ìˆìŒ

#### 3. SelectPair ì»´í¬ë„ŒíŠ¸ì— required, defaultValue ì¶”ê°€ (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)

**í˜„ì¬ ìƒíƒœ**: SelectPairì— required, defaultValue ì—†ìŒ

**ì ìš© ë°©ì•ˆ**: InputPairì™€ ë™ì¼í•œ íŒ¨í„´ ì ìš©

**ì¥ì **: ì¼ê´€ëœ ì»´í¬ë„ŒíŠ¸ API

#### 4. ì¡°ê±´ë¶€ ë Œë”ë§ íŒ¨í„´ ê°•í™” (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)

**í˜„ì¬ ìƒíƒœ**: ì¼ë¶€ í˜ì´ì§€ì—ì„œë§Œ ì ìš©

**ì ìš© ë°©ì•ˆ**: useOutletContextë¥¼ í™œìš©í•œ ì¡°ê±´ë¶€ ë Œë”ë§

**ì¥ì **: Props drilling ë°©ì§€

## êµ¬í˜„ ìš°ì„ ìˆœìœ„

### ë†’ìŒ (ì¦‰ì‹œ ì ìš© ê¶Œì¥)

1. **Alert ì»´í¬ë„ŒíŠ¸ ì¶”ê°€**
   - ì˜í–¥ë„: ë†’ìŒ (UX ê°œì„ )
   - ë‚œì´ë„: ë‚®ìŒ
   - íš¨ê³¼: ì¼ê´€ëœ ì•Œë¦¼ UI, ì ‘ê·¼ì„± í–¥ìƒ

2. **í”„ë¡œí•„ í¸ì§‘ í˜ì´ì§€ êµ¬í˜„**
   - ì˜í–¥ë„: ë†’ìŒ (ê¸°ëŠ¥ ì¶”ê°€)
   - ë‚œì´ë„: ì¤‘ê°„
   - íš¨ê³¼: ì‚¬ìš©ìê°€ í”„ë¡œí•„ í¸ì§‘ ê°€ëŠ¥

### ì¤‘ê°„ (ì ì§„ì  ì ìš©)

3. **SelectPair ì»´í¬ë„ŒíŠ¸ ê°œì„ **
   - ì˜í–¥ë„: ì¤‘ê°„ (ì½”ë“œ í’ˆì§ˆ)
   - ë‚œì´ë„: ë‚®ìŒ
   - íš¨ê³¼: ì¼ê´€ëœ ì»´í¬ë„ŒíŠ¸ API

4. **ì¡°ê±´ë¶€ ë Œë”ë§ íŒ¨í„´ ê°•í™”**
   - ì˜í–¥ë„: ì¤‘ê°„ (ì½”ë“œ êµ¬ì¡° ê°œì„ )
   - ë‚œì´ë„: ë‚®ìŒ
   - íš¨ê³¼: Props drilling ë°©ì§€

## ì°¸ê³ ì‚¬í•­

- Alert ì»´í¬ë„ŒíŠ¸ëŠ” `role="alert"`ë¡œ ì ‘ê·¼ì„± í–¥ìƒ
- `optional().default("")`ë¡œ ì˜µì…”ë„ í•„ë“œ ì²˜ë¦¬
- `useOutletContext`ëŠ” ìƒìœ„ Layoutì˜ ë°ì´í„° ì ‘ê·¼ì— ìœ ìš©
- Form í•„ë“œì— `defaultValue` ì„¤ì • ì‹œ Loader ë°ì´í„° ì‚¬ìš©
- ì„±ê³µ ë©”ì‹œì§€ëŠ” ìƒë‹¨ì—, ì—ëŸ¬ ë©”ì‹œì§€ëŠ” í•„ë“œë³„ë¡œ í‘œì‹œ

