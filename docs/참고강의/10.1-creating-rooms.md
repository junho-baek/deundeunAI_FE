# 10.1 Creating Rooms

## 커밋 요약

커밋 `09e7319`에서는 사용자가 다른 사용자에게 메시지를 보낼 때 **메시지 방을 자동으로 만들거나 기존 방을 재사용**하는 기능을 구현했습니다.

### 주요 변경 내용

1. **Postgres 함수 `get_room`**
   - `message_room_members`를 두 번 조인해 두 사용자 모두가 속한 방을 찾음.
   - 없으면 빈 결과를 반환하므로 애플리케이션에서 새 방을 생성.

2. **`sendMessage` mutation**
   - `get_room` 호출 → 기존 방이면 메시지만 삽입.
   - 없으면 `message_rooms`, `message_room_members`, `messages`를 순서대로 삽입.

3. **Team/프로필 UI**
   - “팀장에게 소개 메시지 보내기” 폼을 POST action으로 연결.
   - 액션에서 `sendMessage` 호출 후 `/my/messages/:roomId`로 리다이렉트.

4. **라우팅**
   - `/my/messages` → `send-message-page.tsx` 액션/라우트 추가.

## 든든 AI 적용 아이디어

### 1. 프로젝트 담당자 DM
프로젝트 워크스페이스에서 **담당 에디터/오퍼레이터에게 DM 보내기** 기능을 넣을 수 있습니다.
- `project_collaborators` 같은 테이블에서 각 프로젝트에 연결된 담당자를 가져오고,
- “담당자에게 문의하기” 버튼 클릭 시 `sendMessage` 패턴을 재사용해 1:1 방을 생성합니다.
- 메시지 내용에는 현재 단계/상태/프로젝트 ID를 자동으로 포함시키면 HITL 운영자가 빠르게 컨텍스트를 파악할 수 있습니다.

### 2. 그룹 채팅 or Broadcast
현재 로직은 1:1 전용입니다. 다자간 메시지가 필요하다면:
- `message_room_members`에 여러 명을 추가하여 프로젝트별 그룹 방을 생성,
- `get_room` 변형을 통해 “같은 프로젝트 멤버 전체” 방을 찾도록 확장할 수 있습니다.

### 3. 프로젝트 이벤트 → 자동 메시지
워크플로 단계가 특정 조건을 만족했을 때, `sendMessage`를 호출해 담당자에게 시스템 메시지를 발송하는 것도 가능합니다. 예: “이미지 재생성 요청이 3회 실패했습니다. 확인해주세요.”

필요하면 프로젝트 모듈에 DM/알림 상태를 표시하는 UI, 또는 `/my/messages/:roomId` 페이지도 추가할 수 있습니다. 알려주시면 이어서 작업할게요.
