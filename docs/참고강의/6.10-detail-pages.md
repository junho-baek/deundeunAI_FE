# 6.10 Detail Pages (ìƒì„¸ í˜ì´ì§€)

## ê°œìš”

ì»¤ë®¤ë‹ˆí‹° í¬ìŠ¤íŠ¸, ì¡, íŒ€ì˜ ìƒì„¸ í˜ì´ì§€ë¥¼ ì‹¤ì œ DB ë°ì´í„°ë¡œ êµ¬í˜„í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. ê° ìƒì„¸ í˜ì´ì§€ëŠ” `loader`ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¡œë“œí•˜ê³ , Viewë‚˜ ê´€ê³„ ì¡°íšŒë¥¼ í™œìš©í•˜ì—¬ í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜µë‹ˆë‹¤.

## ì£¼ìš” ë³€ê²½ì‚¬í•­

### 1. ì»¤ë®¤ë‹ˆí‹° í¬ìŠ¤íŠ¸ ìƒì„¸ í˜ì´ì§€ (`post-page.tsx`)

#### ë³€ê²½ ì „
- í•˜ë“œì½”ë”©ëœ ë°ì´í„° ì‚¬ìš©
- ìƒëŒ€ ì‹œê°„ í‘œì‹œ ì—†ìŒ
- ì‘ì„±ì ì •ë³´ í•˜ë“œì½”ë”©

#### ë³€ê²½ í›„
- `loader` í•¨ìˆ˜ë¡œ ë°ì´í„° ë¯¸ë¦¬ ë¡œë“œ
- `getPostById`ë¡œ Viewì—ì„œ ë°ì´í„° ì¡°íšŒ
- Luxonìœ¼ë¡œ ìƒëŒ€ ì‹œê°„ í‘œì‹œ (`DateTime.fromISO().toRelative()`)
- ì‹¤ì œ ì‘ì„±ì ì •ë³´ í‘œì‹œ (ì´ë¦„, ì•„ë°”íƒ€, ì—­í• , ê°€ì…ì¼, ì œí’ˆ ìˆ˜)

#### ì£¼ìš” íŒ¨í„´

**Loader ì¶”ê°€:**
```typescript
export const loader = async ({ params }: Route.LoaderArgs) => {
  const post = await getPostById(params.postId);
  return { post };
};
```

**ì‹¤ì œ ë°ì´í„° ì‚¬ìš©:**
```typescript
export default function PostPage({ loaderData }: Route.ComponentProps) {
  const { post } = loaderData;
  
  return (
    <>
      <h2>{post.title}</h2>
      <span>{post.author_name}</span>
      <span>{DateTime.fromISO(post.created_at).toRelative()}</span>
      <span>{post.replies} replies</span>
      <p>{post.content}</p>
    </>
  );
}
```

**Breadcrumb ë™ì  ë§í¬:**
```typescript
<Link to={`/community?topic=${post.topic_slug}`}>
  {post.topic_name}
</Link>
```

**ì‘ì„±ì ì •ë³´ í‘œì‹œ:**
```typescript
<Avatar>
  {post.author_avatar ? (
    <AvatarImage src={post.author_avatar} />
  ) : null}
  <AvatarFallback>{post.author_name[0]}</AvatarFallback>
</Avatar>
<span>
  ğŸ‚ Joined {DateTime.fromISO(post.author_created_at).toRelative()} ago
</span>
<span>ğŸš€ Launched {post.products} products</span>
```

### 2. ì¡ ìƒì„¸ í˜ì´ì§€ (`job-page.tsx`)

#### ë³€ê²½ ì „
- í•˜ë“œì½”ë”©ëœ ë°ì´í„° ì‚¬ìš©
- ë¬¸ìì—´ ë°°ì—´ í•˜ë“œì½”ë”©

#### ë³€ê²½ í›„
- `loader` í•¨ìˆ˜ë¡œ ë°ì´í„° ë¯¸ë¦¬ ë¡œë“œ
- `getJobById`ë¡œ ì‹¤ì œ DB ë°ì´í„° ì¡°íšŒ
- ì½¤ë§ˆë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´ì„ ë°°ì—´ë¡œ ë³€í™˜ (`.split(",")`)

#### ì£¼ìš” íŒ¨í„´

**Loader ì¶”ê°€:**
```typescript
export const loader = async ({ params }: Route.LoaderArgs) => {
  const job = await getJobById(params.jobId);
  return { job };
};
```

**ë¬¸ìì—´ ë°°ì—´ ë³€í™˜:**
```typescript
// Responsibilities, Qualifications, Benefits, Skills ë“±
{job.responsibilities.split(",").map((item) => (
  <li key={item}>{item}</li>
))}
```

**ë™ì  ë°ì´í„° í‘œì‹œ:**
```typescript
<h1>{job.position}</h1>
<h4>{job.company_name}</h4>
<img src={job.company_logo} />
<Badge>{job.job_type}</Badge>
<span>{job.salary_range}</span>
<span>Posted {DateTime.fromISO(job.created_at).toRelative()}</span>
```

### 3. íŒ€ ìƒì„¸ í˜ì´ì§€ (`team-page.tsx`)

#### ë³€ê²½ ì „
- í•˜ë“œì½”ë”©ëœ ë°ì´í„° ì‚¬ìš©
- íŒ€ ë¦¬ë” ì •ë³´ í•˜ë“œì½”ë”©

#### ë³€ê²½ í›„
- `loader` í•¨ìˆ˜ë¡œ ë°ì´í„° ë¯¸ë¦¬ ë¡œë“œ
- `getTeamById`ë¡œ ê´€ê³„ ì¡°íšŒë¥¼ í¬í•¨í•œ ë°ì´í„° ì¡°íšŒ
- ì‹¤ì œ íŒ€ ë¦¬ë” ì •ë³´ í‘œì‹œ

#### ì£¼ìš” íŒ¨í„´

**Loader ì¶”ê°€:**
```typescript
export const loader = async ({ params }: Route.LoaderArgs) => {
  const team = await getTeamById(params.teamId);
  return { team };
};
```

**Hero ì œëª© ë™ì  ìƒì„±:**
```typescript
<Hero title={`Join ${team.team_leader.name}'s team`} />
```

**íŒ€ ì •ë³´ ì¹´ë“œ:**
```typescript
{[
  { title: "Product name", value: team.product_name },
  { title: "Stage", value: team.product_stage },
  { title: "Team size", value: team.team_size },
  { title: "Available equity", value: team.equity_split },
].map((item) => (
  <Card>
    <CardTitle>{item.title}</CardTitle>
    <CardContent className="capitalize">{item.value}</CardContent>
  </Card>
))}
```

**ì—­í•  ëª©ë¡:**
```typescript
{team.roles.split(",").map((item) => (
  <li key={item}>{item}</li>
))}
```

**íŒ€ ë¦¬ë” ì •ë³´:**
```typescript
<Avatar>
  {team.team_leader.avatar ? (
    <AvatarImage src={team.team_leader.avatar} />
  ) : null}
  <AvatarFallback>{team.team_leader.name[0]}</AvatarFallback>
</Avatar>
<h4>{team.team_leader.name}</h4>
<Badge className="capitalize">{team.team_leader.role}</Badge>
```

## ì¿¼ë¦¬ í•¨ìˆ˜ êµ¬í˜„

### 1. `getPostById` (Community)

**íŒŒì¼:** `app/features/community/queries.ts`

```typescript
export const getPostById = async (postId: string) => {
  const { data, error } = await client
    .from("community_post_detail")
    .select("*")
    .eq("post_id", postId)
    .single();
  
  if (error) throw error;
  return data;
};
```

**íŠ¹ì§•:**
- View (`community_post_detail`) ì‚¬ìš©
- `.single()`ë¡œ ë‹¨ì¼ ë ˆì½”ë“œ ë°˜í™˜
- ì—ëŸ¬ ë°œìƒ ì‹œ throw

### 2. `getJobById` (Jobs)

**íŒŒì¼:** `app/features/jobs/queries.ts`

```typescript
export const getJobById = async (jobId: string) => {
  const { data, error } = await client
    .from("jobs")
    .select("*")
    .eq("job_id", jobId)
    .single();
  
  if (error) throw error;
  return data;
};
```

**íŠ¹ì§•:**
- ì›ë³¸ í…Œì´ë¸” (`jobs`) ì§ì ‘ ì¡°íšŒ
- `.single()`ë¡œ ë‹¨ì¼ ë ˆì½”ë“œ ë°˜í™˜
- ì—ëŸ¬ ë°œìƒ ì‹œ throw

### 3. `getTeamById` (Teams)

**íŒŒì¼:** `app/features/teams/queries.ts`

```typescript
export const getTeamById = async (teamId: string) => {
  const { data, error } = await client
    .from("teams")
    .select(`
      *,
      team_leader:profiles!inner(
        name,
        avatar,
        role
      )
    `)
    .eq("team_id", teamId)
    .single();
  
  if (error) throw error;
  return data;
};
```

**íŠ¹ì§•:**
- ê´€ê³„ ì¡°íšŒ (`profiles!inner`) ì‚¬ìš©
- `!inner`ë¡œ íŒ€ ë¦¬ë”ê°€ ë°˜ë“œì‹œ ì¡´ì¬í•´ì•¼ í•¨
- í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒ (`name`, `avatar`, `role`)

## View ìƒì„±

### `community_post_detail` View

**íŒŒì¼:** `app/sql/views/community-post-detail.sql`

```sql
CREATE OR REPLACE VIEW community_post_detail AS
SELECT
    posts.post_id,
    posts.title,
    posts.content,
    posts.upvotes,
    posts.created_at,
    topics.topic_id,
    topics.name as topic_name,
    topics.slug as topic_slug,
    COUNT(post_replies.post_reply_id) as replies,
    profiles.name as author_name,
    profiles.avatar as author_avatar,
    profiles.role as author_role,
    profiles.created_at as author_created_at,
    (SELECT COUNT(*) FROM products 
     WHERE products.profile_id = profiles.profile_id) as products
FROM posts
INNER JOIN topics USING (topic_id)
LEFT JOIN post_replies USING (post_id)
INNER JOIN profiles ON (profiles.profile_id = posts.profile_id)
GROUP BY posts.post_id, topics.topic_id, topics.name, topics.slug, 
         profiles.name, profiles.avatar, profiles.role, 
         profiles.created_at, profiles.profile_id;
```

**íŠ¹ì§•:**
- `INNER JOIN`ìœ¼ë¡œ í•„ìˆ˜ ê´€ê³„ë§Œ í¬í•¨
- `LEFT JOIN`ìœ¼ë¡œ ëŒ“ê¸€ ìˆ˜ ì§‘ê³„ (ì—†ì–´ë„ 0)
- ì„œë¸Œì¿¼ë¦¬ë¡œ ì‘ì„±ìì˜ ì œí’ˆ ìˆ˜ ê³„ì‚°
- `GROUP BY`ë¡œ ì§‘ê³„ í•¨ìˆ˜ ì‚¬ìš©

## íƒ€ì… ì •ì˜ ì—…ë°ì´íŠ¸

### 1. `supa-client.ts`

**View íƒ€ì… ì¶”ê°€:**
```typescript
type Database = MergeDeep<
  SupabaseDatabase,
  {
    public: {
      Views: {
        // ... ê¸°ì¡´ Views
        community_post_detail: {
          Row: SetNonNullable<
            SupabaseDatabase["public"]["Views"]["community_post_detail"]["Row"]
          >;
        };
      };
    };
  }
>;
```

### 2. `database.types.ts`

**View íƒ€ì… ì •ì˜:**
```typescript
Views: {
  community_post_detail: {
    Row: {
      post_id: number | null;
      title: string | null;
      content: string | null;
      upvotes: number | null;
      created_at: string | null;
      topic_id: number | null;
      topic_name: string | null;
      topic_slug: string | null;
      replies: number | null;
      author_name: string | null;
      author_avatar: string | null;
      author_role: Database["public"]["Enums"]["role"] | null;
      author_created_at: string | null;
      products: number | null;
    };
    Relationships: [];
  };
}
```

**Relationships ì—…ë°ì´íŠ¸:**
- `notifications`, `post_replies`, `post_upvotes`, `posts` í…Œì´ë¸”ì˜ ê´€ê³„ì— `community_post_detail` View ì°¸ì¡° ì¶”ê°€

## ì£¼ìš” íŒ¨í„´ ì •ë¦¬

### 1. Loader íŒ¨í„´

**ëª¨ë“  ìƒì„¸ í˜ì´ì§€ì— ì ìš©:**
```typescript
export const loader = async ({ params }: Route.LoaderArgs) => {
  const item = await getItemById(params.itemId);
  return { item };
};
```

**ì¥ì :**
- ì„œë²„ì—ì„œ ë°ì´í„° ë¯¸ë¦¬ ë¡œë“œ
- í´ë¼ì´ì–¸íŠ¸ ë Œë”ë§ ì „ ë°ì´í„° ì¤€ë¹„ ì™„ë£Œ
- SEO ë° ì´ˆê¸° ë¡œë”© ì„±ëŠ¥ í–¥ìƒ

### 2. View vs ê´€ê³„ ì¡°íšŒ

**View ì‚¬ìš© (`community_post_detail`):**
- ë³µì¡í•œ JOINê³¼ ì§‘ê³„ê°€ í•„ìš”í•œ ê²½ìš°
- ì—¬ëŸ¬ í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ í‰íƒ„í™”í•´ì•¼ í•˜ëŠ” ê²½ìš°
- ìì£¼ ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ íŒ¨í„´

**ê´€ê³„ ì¡°íšŒ (`getTeamById`):**
- ë‹¨ìˆœí•œ 1:1 ë˜ëŠ” 1:N ê´€ê³„
- í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒ ê°€ëŠ¥
- ë” ìœ ì—°í•œ ì¿¼ë¦¬ êµ¬ì„±

### 3. ë¬¸ìì—´ ë°°ì—´ ë³€í™˜

**ì½¤ë§ˆë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´ ì²˜ë¦¬:**
```typescript
// DBì— "item1,item2,item3" í˜•íƒœë¡œ ì €ì¥ëœ ê²½ìš°
{data.split(",").map((item) => (
  <li key={item}>{item.trim()}</li>
))}
```

**ì£¼ì˜ì‚¬í•­:**
- `.trim()`ìœ¼ë¡œ ê³µë°± ì œê±°
- ë¹ˆ ë¬¸ìì—´ í•„í„°ë§ ê³ ë ¤ (`filter(item => item.length > 0)`)

### 4. ìƒëŒ€ ì‹œê°„ í‘œì‹œ

**Luxon ì‚¬ìš©:**
```typescript
import { DateTime } from "luxon";

DateTime.fromISO(dateString).toRelative()
// "2 hours ago", "3 days ago" ë“±
```

**ì¥ì :**
- ì‚¬ìš©ì ì¹œí™”ì ì¸ ì‹œê°„ í‘œì‹œ
- ìë™ìœ¼ë¡œ ì ì ˆí•œ ë‹¨ìœ„ ì„ íƒ
- ë‹¤êµ­ì–´ ì§€ì› ê°€ëŠ¥

### 5. Null ì•ˆì „ ì²˜ë¦¬

**ì•„ë°”íƒ€ ì´ë¯¸ì§€:**
```typescript
{avatarUrl ? (
  <AvatarImage src={avatarUrl} />
) : null}
<AvatarFallback>{name[0]}</AvatarFallback>
```

**ë°°ì—´ ì ‘ê·¼:**
```typescript
{name[0]} // ì²« ê¸€ìë¡œ fallback
```

## ì ìš© ê°€ì´ë“œ

### 1. í”„ë¡œì íŠ¸ ìƒì„¸ í˜ì´ì§€ì— ì ìš©

**í˜„ì¬ ìƒíƒœ:**
- `project-workspace-page.tsx`ê°€ ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆìŒ
- `getProjectById`ë¡œ ë°ì´í„° ì¡°íšŒ ì¤‘

**ê°œì„  ê°€ëŠ¥í•œ ë¶€ë¶„:**
- View ìƒì„±ìœ¼ë¡œ ë³µì¡í•œ JOIN ë‹¨ìˆœí™”
- ìƒëŒ€ ì‹œê°„ í‘œì‹œ ì¶”ê°€
- ì‘ì„±ì ì •ë³´ ë” ìì„¸íˆ í‘œì‹œ

### 2. ìƒˆë¡œìš´ ìƒì„¸ í˜ì´ì§€ ì¶”ê°€ ì‹œ

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
1. âœ… `loader` í•¨ìˆ˜ ì¶”ê°€
2. âœ… `getXxxById` ì¿¼ë¦¬ í•¨ìˆ˜ êµ¬í˜„
3. âœ… View í•„ìš” ì—¬ë¶€ íŒë‹¨ (ë³µì¡í•œ JOIN/ì§‘ê³„)
4. âœ… ê´€ê³„ ì¡°íšŒ í•„ìš” ì—¬ë¶€ íŒë‹¨
5. âœ… íƒ€ì… ì •ì˜ ì—…ë°ì´íŠ¸ (`supa-client.ts`, `database.types.ts`)
6. âœ… Null ì•ˆì „ ì²˜ë¦¬
7. âœ… ìƒëŒ€ ì‹œê°„ í‘œì‹œ (í•„ìš”ì‹œ)
8. âœ… ë¬¸ìì—´ ë°°ì—´ ë³€í™˜ (í•„ìš”ì‹œ)

### 3. ì„±ëŠ¥ ìµœì í™”

**View ì‚¬ìš© ì‹œ:**
- ìì£¼ ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ë§Œ Viewë¡œ ìƒì„±
- ì¸ë±ìŠ¤ê°€ í•„ìš”í•œ ì»¬ëŸ¼ í™•ì¸
- ë¶ˆí•„ìš”í•œ JOIN ìµœì†Œí™”

**ê´€ê³„ ì¡°íšŒ ì‹œ:**
- í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒ
- `!inner` vs `!left` ì ì ˆíˆ ì„ íƒ
- ì¤‘ì²© ê´€ê³„ ê¹Šì´ ì œí•œ

## ì£¼ì˜ì‚¬í•­

### 1. View ì—…ë°ì´íŠ¸

**ViewëŠ” ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ:**
- ì›ë³¸ í…Œì´ë¸” ë³€ê²½ ì‹œ View ì¬ìƒì„± í•„ìš”
- ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì— View ì •ì˜ í¬í•¨ ê¶Œì¥

### 2. ì—ëŸ¬ ì²˜ë¦¬

**`.single()` ì‚¬ìš© ì‹œ:**
- ë ˆì½”ë“œê°€ ì—†ìœ¼ë©´ ì—ëŸ¬ ë°œìƒ
- 404 í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê³ ë ¤
- `try-catch`ë¡œ ì—ëŸ¬ ì²˜ë¦¬

### 3. íƒ€ì… ì•ˆì „ì„±

**View íƒ€ì… ì •ì˜:**
- `database.types.ts` ìë™ ìƒì„± í›„ ìˆ˜ë™ ì—…ë°ì´íŠ¸ í•„ìš”
- `SetNonNullable`ë¡œ null ì œê±°
- ì‹¤ì œ ì‚¬ìš© íŒ¨í„´ì— ë§ê²Œ íƒ€ì… ì¡°ì •

## ì°¸ê³ ì‚¬í•­

- **Luxon**: ë‚ ì§œ/ì‹œê°„ ì²˜ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ìƒëŒ€ ì‹œê°„, í¬ë§·íŒ… ë“±)
- **View**: ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í˜•íƒœë¡œ ìº¡ìŠí™”
- **ê´€ê³„ ì¡°íšŒ**: Supabaseì˜ `select()` ë‚´ë¶€ì—ì„œ JOIN ìˆ˜í–‰
- **`.single()`**: ë‹¨ì¼ ë ˆì½”ë“œë§Œ ë°˜í™˜, ì—†ìœ¼ë©´ ì—ëŸ¬

## ê´€ë ¨ íŒŒì¼

- `app/features/community/pages/post-page.tsx`
- `app/features/community/queries.ts`
- `app/features/jobs/pages/job-page.tsx`
- `app/features/jobs/queries.ts`
- `app/features/teams/pages/team-page.tsx`
- `app/features/teams/queries.ts`
- `app/sql/views/community-post-detail.sql`
- `app/lib/supa-client.ts`
- `app/database.types.ts`

