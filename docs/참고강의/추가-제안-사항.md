# 추가 제안 사항 (우선순위 낮음)

이 문서는 참고강의 문서들에서 우선순위가 낮은 제안 사항들을 모아서 정리한 것입니다. 현재 프로젝트에서 즉시 적용할 필요는 없지만, 향후 개선 시 참고할 수 있는 사항들입니다.

## 목차

1. [데이터베이스 및 스키마](#데이터베이스-및-스키마)
2. [쿼리 및 데이터 조회](#쿼리-및-데이터-조회)
3. [UI/UX 개선](#uiux-개선)
4. [타입 및 코드 품질](#타입-및-코드-품질)
5. [성능 최적화](#성능-최적화)
6. [보안 및 접근 제어](#보안-및-접근-제어)

---

## 데이터베이스 및 스키마

### 1. 스키마에 NOT NULL 제약조건 명시

**출처**: 8.6 Create Review

**현재 상태**: 일부 스키마에서만 명시

**적용 방안**: 필수 필드에 `.notNull()` 추가

**예시**:
```typescript
product_id: bigint({ mode: "number" })
  .references(() => products.product_id, {
    onDelete: "cascade",
  })
  .notNull(),
profile_id: uuid()
  .references(() => profiles.profile_id, {
    onDelete: "cascade",
  })
  .notNull(),
```

**장점**: 데이터 무결성 보장

**우선순위**: 낮음 (데이터 무결성)

---

### 2. SQL View에서 조건부 데이터 반환

**출처**: 8.5 Claimed Ideas

**현재 상태**: View 사용 중이지만 조건부 처리 부족

**적용 방안**:
```sql
CREATE OR REPLACE VIEW resource_view AS
SELECT
  resource_id,
  CASE 
    WHEN is_private AND current_user_id != owner_id 
    THEN NULL  -- 또는 기본값
    ELSE content 
  END AS content,
  -- ...
```

**장점**: 데이터베이스 레벨에서 접근 제어

**우선순위**: 낮음 (보안 강화)

---

## 쿼리 및 데이터 조회

### 3. Queries에 정렬 추가

**출처**: 8.6 Create Review, 8.3 Post Replies Part One

**현재 상태**: 일부 쿼리에 정렬이 없을 수 있음

**적용 방안**: 목록 조회 시 항상 정렬 명시

**예시**:
```typescript
.order("created_at", { ascending: false }) // 최신순
.order("created_at", { ascending: true })  // 오래된순
```

**장점**: 일관된 데이터 순서 보장

**우선순위**: 낮음 (데이터 일관성)

---

### 4. RPC 함수를 통한 복잡한 통계 조회

**출처**: 8.7 Dashboard Chart, 8.8 Product Analytics Chart

**현재 상태**: 일부 통계는 클라이언트에서 계산

**적용 방안**:
```sql
CREATE OR REPLACE FUNCTION get_project_stats_rpc(project_id uuid)
RETURNS TABLE (
    total_views bigint,
    total_likes bigint,
    avg_ctr numeric,
    month text
) AS $$
BEGIN
    RETURN QUERY
    SELECT
        COUNT(*) AS total_views,
        SUM(likes) AS total_likes,
        AVG(ctr) AS avg_ctr,
        to_char(created_at, 'YYYY-MM') AS month
    FROM public.project_metrics
    WHERE project_id = get_project_stats_rpc.project_id
    GROUP BY month;
END;
$$ LANGUAGE plpgsql;
```

**적용 대상**:
- 복잡한 집계가 필요한 통계
- 성능이 중요한 대시보드

**장점**:
- 데이터베이스 레벨에서 최적화 가능
- 복잡한 로직 캡슐화
- 재사용 가능

**우선순위**: 중간 (성능 개선) - 필요 시 적용

---

### 5. RPC 함수를 통한 이벤트 기반 통계 조회

**출처**: 8.8 Product Analytics Chart

**현재 상태**: 이벤트 트래킹은 있지만 통계 조회는 제한적

**적용 방안**:
```sql
CREATE OR REPLACE FUNCTION get_project_stats_by_events(
    project_id uuid,
    start_date date,
    end_date date
)
RETURNS TABLE (
    month text,
    total_views bigint,
    total_clicks bigint,
    conversion_rate numeric
) AS $$
BEGIN
    RETURN QUERY
    SELECT
        to_char(created_at, 'YYYY-MM') AS month,
        SUM(CASE WHEN event_type = 'project_view' THEN 1 ELSE 0 END) AS total_views,
        SUM(CASE WHEN event_type = 'project_click' THEN 1 ELSE 0 END) AS total_clicks,
        CASE 
            WHEN SUM(CASE WHEN event_type = 'project_view' THEN 1 ELSE 0 END) > 0
            THEN (SUM(CASE WHEN event_type = 'project_click' THEN 1 ELSE 0 END)::numeric / 
                  SUM(CASE WHEN event_type = 'project_view' THEN 1 ELSE 0 END)::numeric) * 100
            ELSE 0
        END AS conversion_rate
    FROM public.events
    WHERE event_data ->> 'project_id' = project_id::text
      AND created_at >= start_date
      AND created_at <= end_date
    GROUP BY month
    ORDER BY month;
END;
$$ LANGUAGE plpgsql;
```

**적용 대상**:
- 프로젝트 분석 페이지
- 대시보드 통계
- 이벤트 기반 분석

**장점**:
- 이벤트 기반 상세 분석
- 성능 최적화

**우선순위**: 중간 (기능 추가) - 필요 시 적용

---

### 6. Mock 데이터를 실제 데이터로 교체

**출처**: 8.7 Dashboard Chart

**현재 상태**: 일부 컴포넌트에서 Mock 데이터 사용

**적용 방안**: Loader에서 실제 데이터 조회 후 전달

**적용 대상**:
- 차트 데이터
- 목록 데이터
- 통계 데이터

**장점**: 실제 데이터 기반 UI

**우선순위**: 중간 (기능 완성도) - 점진적 적용

---

## UI/UX 개선

### 7. 동적 사이드바 메뉴 생성

**출처**: 8.7 Dashboard Chart

**현재 상태**: 정적 메뉴 사용

**적용 방안**: Layout Loader에서 데이터 조회 후 동적 메뉴 생성

**장점**: 사용자별 맞춤 메뉴 제공

**우선순위**: 낮음 (UX 개선)

---

### 8. DateTime 처리 개선 (`unit` 제거)

**출처**: 8.3 Post Replies Part One

**현재 상태**: 일부 DateTime 처리에 `unit` 옵션 사용

**적용 방안**: `unit` 옵션 제거하여 더 자연스러운 상대 시간 표시

**예시**:
```typescript
// 변경 전
DateTime.fromISO(date, { zone: "utc" }).toRelative({ unit: "hours" })

// 변경 후
DateTime.fromISO(date, { zone: "utc" }).toRelative()
```

**장점**: 더 자연스러운 시간 표시

**우선순위**: 낮음 (UX 개선)

---

### 9. Form 필드에 `required`, `placeholder`, `defaultValue` 추가

**출처**: 8.2 Create Team Page, 8.1 Submit Job Page

**현재 상태**: 일부 Form에서만 사용

**적용 방안**:
```typescript
<InputPair
  label="프로젝트 키워드"
  name="keyword"
  type="text"
  id="keyword"
  required
  placeholder="예: AI 마케팅 영상"
  defaultValue=""
/>
```

**장점**:
- HTML5 유효성 검사 활용
- 사용자 경험 개선
- 개발 편의성 향상

**우선순위**: 낮음 (UX 개선)

---

### 10. Meta 함수에서 동적 제목 사용 강화

**출처**: 8.1 Submit Job Page

**현재 상태**: 일부 페이지에서만 사용

**적용 방안**: 모든 상세 페이지에서 loaderData 기반 동적 제목 사용

**예시**:
```typescript
export const meta: MetaFunction = ({ data }) => {
  return [
    { title: `${data.project.title} | 든든AI` },
    { name: "description", content: data.project.description || "" },
  ];
};
```

**장점**: SEO 및 사용자 경험 개선

**우선순위**: 낮음 (SEO 개선)

---

## 타입 및 코드 품질

### 11. Mutations에서 `z.infer<typeof formSchema>` 사용

**출처**: 8.2 Create Team Page

**현재 상태**: Mutations에서 직접 타입 정의

**적용 방안**: FormSchema 타입을 재사용

**예시**:
```typescript
// 현재
export async function createProject(
  client: SupabaseClient<Database>,
  projectData: {
    project_id?: string;
    owner_profile_id: string;
    title: string;
    // ...
  }
)

// 개선 (formSchema가 있는 경우)
import { formSchema } from "./pages/project-create-page";

export async function createProject(
  client: SupabaseClient<Database>,
  projectData: z.infer<typeof formSchema> & {
    project_id?: string;
    owner_profile_id: string;
  }
)
```

**장점**:
- 타입 중복 제거
- FormSchema와 Mutations 타입 일관성 유지

**주의사항**: FormSchema와 Mutations 파라미터가 완전히 일치하지 않을 수 있으므로, 필요시 `&`로 확장

**우선순위**: 낮음 (타입 중복 제거)

---

### 12. 차트 데이터 키 명명 규칙 통일

**출처**: 8.8 Product Analytics Chart

**현재 상태**: 일부 차트에서 키 이름이 일관되지 않을 수 있음

**적용 방안**: RPC 함수 반환값과 차트 데이터 키를 일치시키기

**예시**:
```typescript
// RPC 함수 반환값
{ product_views: number, product_visits: number, month: string }

// 차트에서 사용
dataKey="product_views" // 일치
```

**장점**: 코드 일관성 향상

**우선순위**: 낮음 (코드 품질)

---

### 13. Hidden Input을 통한 데이터 전달

**출처**: 8.4 Post Replies Part Two

**현재 상태**: 일부 Form에서 사용 중

**적용 방안**:
```typescript
<Form method="post">
  <input type="hidden" name="parentId" value={parentId} />
  {/* 나머지 폼 필드 */}
</Form>
```

**장점**: URL에 노출되지 않고 데이터 전달 가능

**우선순위**: 낮음 (코드 품질)

---

### 14. `z.coerce`를 통한 타입 변환

**출처**: 8.4 Post Replies Part Two

**현재 상태**: 일부 스키마에서 사용 중

**적용 방안**:
```typescript
const formSchema = z.object({
  id: z.coerce.number(),        // 문자열 → 숫자
  optionalId: z.coerce.number().optional(), // 옵셔널
});
```

**장점**: Form 데이터는 항상 문자열이므로 자동 변환 유용

**우선순위**: 낮음 (코드 품질)

---

### 15. Action에서 `{ ok: true }` 반환 패턴

**출처**: 8.3 Post Replies Part One

**현재 상태**: 대부분 redirect 사용

**적용 방안**: 같은 페이지에 머물면서 상태만 업데이트해야 하는 경우 `{ ok: true }` 반환

**예시**:
```typescript
export const action = async ({ request }: Route.ActionArgs) => {
  // ... 처리 로직
  
  return {
    ok: true,
  };
};
```

**장점**: 리다이렉트 없이 같은 페이지 유지하면서 상태 업데이트

**적용 대상**:
- 댓글 작성
- 좋아요/북마크 토글
- 기타 같은 페이지에 머물면서 상태만 변경하는 경우

**우선순위**: 낮음 (UX 개선)

---

### 16. Form에 `method="post"` 명시

**출처**: 8.1 Submit Job Page

**현재 상태**: 일부 Form에서만 명시

**적용 방안**: 모든 Form 컴포넌트에 명시

**예시**:
```typescript
<Form className="..." method="post">
```

**장점**: 명시적으로 POST 요청임을 표시

**우선순위**: 낮음 (코드 명확성)

---

## 성능 최적화

### 17. RPC 함수를 통한 프로젝트 통계 조회

**출처**: 8.8 Product Analytics Chart (추가 제안)

**현재 상태**: `getProjectAnalytics`가 여러 쿼리를 조합

**적용 방안**: 복잡한 집계가 많아지면 RPC 함수로 이동 고려

**예시**:
```sql
CREATE OR REPLACE FUNCTION get_project_analytics_rpc(
    project_id uuid,
    start_date date DEFAULT NULL,
    end_date date DEFAULT NULL
)
RETURNS TABLE (
    total_views bigint,
    total_likes bigint,
    avg_ctr numeric,
    month text
) AS $$
BEGIN
    RETURN QUERY
    SELECT
        SUM(views) AS total_views,
        SUM(likes) AS total_likes,
        AVG(ctr) AS avg_ctr,
        to_char(created_at, 'YYYY-MM') AS month
    FROM project_metrics
    WHERE project_id = get_project_analytics_rpc.project_id
      AND (start_date IS NULL OR created_at >= start_date)
      AND (end_date IS NULL OR created_at <= end_date)
    GROUP BY month
    ORDER BY month;
END;
$$ LANGUAGE plpgsql;
```

**장점**:
- 데이터베이스 레벨 최적화
- 복잡한 로직 캡슐화
- 재사용성 향상

**단점**:
- 현재 구조로도 충분히 동작
- 과도한 최적화일 수 있음

**우선순위**: 낮음 (성능 최적화) - 필요 시 적용

---

### 18. 이벤트 기반 통계 차트 데이터

**출처**: 8.8 Product Analytics Chart (추가 제안)

**현재 상태**: 프로젝트 메트릭 기반 통계

**적용 방안**: 이벤트 기반 통계 추가 가능

**예시**:
```sql
CREATE OR REPLACE FUNCTION get_project_event_stats(
    project_id uuid,
    months integer DEFAULT 6
)
RETURNS TABLE (
    month text,
    total_views bigint,
    total_clicks bigint,
    conversion_rate numeric
) AS $$
BEGIN
    RETURN QUERY
    SELECT
        to_char(created_at, 'YYYY-MM') AS month,
        SUM(CASE WHEN event_type = 'project_view' THEN 1 ELSE 0 END) AS total_views,
        SUM(CASE WHEN event_type = 'project_click' THEN 1 ELSE 0 END) AS total_clicks,
        CASE 
            WHEN SUM(CASE WHEN event_type = 'project_view' THEN 1 ELSE 0 END) > 0
            THEN (SUM(CASE WHEN event_type = 'project_click' THEN 1 ELSE 0 END)::numeric / 
                  SUM(CASE WHEN event_type = 'project_view' THEN 1 ELSE 0 END)::numeric) * 100
            ELSE 0
        END AS conversion_rate
    FROM public.events
    WHERE event_data ->> 'project_id' = project_id::text
      AND created_at >= CURRENT_DATE - (months || ' months')::interval
    GROUP BY month
    ORDER BY month;
END;
$$ LANGUAGE plpgsql;
```

**장점**: 이벤트 기반 상세 분석 가능

**우선순위**: 낮음 (기능 추가) - 필요 시 적용

---

## 보안 및 접근 제어

### 19. SQL View에서 조건부 데이터 반환

**출처**: 8.5 Claimed Ideas

**현재 상태**: View 사용 중이지만 조건부 처리 부족

**적용 방안**: 데이터베이스 레벨에서 접근 제어

**예시**:
```sql
CREATE OR REPLACE VIEW resource_view AS
SELECT
  resource_id,
  CASE 
    WHEN is_private AND current_user_id != owner_id 
    THEN NULL  -- 또는 기본값
    ELSE content 
  END AS content,
  -- ...
```

**장점**: 데이터베이스 레벨에서 접근 제어

**우선순위**: 낮음 (보안 강화)

---

## 적용 가이드

### 우선순위별 적용 전략

1. **낮음 (선택사항)**: 현재 프로젝트에서 즉시 적용할 필요 없음. 향후 개선 시 참고
2. **중간 (점진적 적용)**: 필요 시 점진적으로 적용 가능. 성능 이슈나 새로운 요구사항 발생 시 검토

### 적용 시 고려사항

- **성능**: RPC 함수나 View 최적화는 실제 성능 이슈가 발생했을 때 적용
- **코드 품질**: 타입 개선이나 명명 규칙 통일은 리팩토링 시 함께 적용
- **UX 개선**: 사용자 피드백이나 요구사항에 따라 우선순위 조정

### 참고 문서

각 제안 사항의 출처 문서를 참고하여 상세한 구현 방법을 확인할 수 있습니다:

- 8.0 Create Post Page
- 8.1 Submit Job Page
- 8.2 Create Team Page
- 8.3 Post Replies Part One
- 8.4 Post Replies Part Two
- 8.5 Claimed Ideas
- 8.6 Create Review
- 8.7 Dashboard Chart
- 8.8 Product Analytics Chart

---

## 업데이트 이력

- 2024-12-30: 초기 문서 작성 (8.0 ~ 8.8 참고강의 문서 기반)

