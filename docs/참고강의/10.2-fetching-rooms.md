# 10.2 Fetching Rooms

## 커밋 요약

커밋 `7d732d7`에서는 사용자 간 DM을 위해 **메시지 룸 목록을 조회하고 UI에 표시**하는 흐름을 구현했습니다.

1. **`messages_view` (SQL View)**  
   - `message_room_members`를 자기 조인하고 `profiles`를 붙여, 현재 프로필과 상대 프로필 정보를 한 번에 가져옵니다.  
   - 각 룸의 최신 메시지를 서브쿼리로 불러와 `last_message` 필드에 넣습니다.

2. **`getMessages` 쿼리**  
   - Supabase View `messages_view`에서 현재 사용자(`profile_id`) 기준으로 룸 리스트를 조회합니다.  
   - `neq("other_profile_id", userId)`로 자기 자신만 있는 레코드는 제외합니다.

3. **Messages Layout**  
   - Loader에서 `getMessages`를 호출해 카드 리스트에 넘깁니다.  
   - UI에서는 `MessageRoomCard`를 반복 렌더링해 상대 이름, 마지막 메시지, 아바타를 표시합니다.

4. **타입 확장**  
   - `supa-client.ts`와 `database.types.ts`에 `messages_view` 타입을 추가해 TypeScript에서도 안전하게 사용합니다.

## 적용 포인트 (Projects 모듈)

- 아직 든든 AI에는 사용자 간 DM UI가 없기 때문에 직접 적용할 부분은 없습니다.  
- 다만 향후 “프로젝트별 협업 채팅”을 도입한다면, 이 View 패턴을 재사용해 프로젝트 멤버의 DM/그룹 채팅 목록을 구성할 수 있습니다.
