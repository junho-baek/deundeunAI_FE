# 6.13 Users Posts

## 커밋 요약

사용자 프로필 페이지에서 사용자의 포스트를 표시하는 기능을 실제 DB 데이터로 전환하고, 메타 정보 관리를 개선한 커밋입니다.

## 주요 변경사항

### 1. 레이아웃에서 Meta 함수 정의

**파일**: `app/features/users/layouts/profile-layout.tsx`

```typescript
export const meta: Route.MetaFunction = ({ data }) => {
  return [{ title: `${data.user.name} | wemake` }];
};
```

**패턴**:
- 레이아웃에서 `meta` 함수를 정의하여 동적 타이틀 설정
- `data` 파라미터를 통해 loader 데이터에 접근
- 사용자 이름을 페이지 타이틀에 포함

**장점**:
- 중복 제거: 각 페이지에서 개별적으로 `meta`를 정의할 필요 없음
- 일관성: 모든 하위 페이지가 동일한 타이틀 형식 사용
- SEO: 사용자 이름이 포함된 의미있는 타이틀

### 2. 페이지에서 Meta 함수 제거

**파일**: `app/features/users/pages/profile-page.tsx`

```typescript
// 제거됨
export const meta: Route.MetaFunction = () => {
  return [{ title: "Profile | wemake" }];
};
```

**이유**: 레이아웃에서 이미 정의했으므로 중복 제거

### 3. Posts 페이지에 Loader 추가

**파일**: `app/features/users/pages/profile-posts-page.tsx`

**변경 전**:
```typescript
export default function ProfilePostsPage({ params }: Route.ComponentProps) {
  return (
    <div className="flex flex-col gap-5">
      {Array.from({ length: 5 }).map((_, index) => (
        <PostCard key={`postId-${index}`} ... />
      ))}
    </div>
  );
}
```

**변경 후**:
```typescript
export const loader = async ({ params }: Route.LoaderArgs) => {
  const posts = await getUserPosts(params.username);
  return { posts };
};

export default function ProfilePostsPage({ loaderData }: Route.ComponentProps) {
  const { posts } = loaderData;
  
  return (
    <div className="flex flex-col gap-5">
      {posts.map((post) => (
        <PostCard
          key={post.post_id}
          id={post.post_id}
          title={post.title}
          author={post.author}
          authorAvatarUrl={post.author_avatar}
          category={post.topic}
          postedAt={post.created_at}
          expanded
        />
      ))}
    </div>
  );
}
```

**패턴**:
- `loader` 함수로 서버 사이드에서 데이터 로드
- 더미 데이터 대신 실제 DB 데이터 사용
- `loaderData`를 통해 컴포넌트에서 데이터 접근

### 4. 쿼리 함수 개선 (View 사용)

**파일**: `app/features/users/queries.ts`

**변경 전**:
```typescript
export const getUserPosts = async (username: string) => {
  const { data, error } = await client
    .from("posts")
    .select("*")
    .eq("username", username);
  // ...
};
```

**변경 후**:
```typescript
export const getUserPosts = async (username: string) => {
  const { data, error } = await client
    .from("community_post_list_view")
    .select("*")
    .eq("author_username", username);
  // ...
};
```

**개선점**:
- View 사용: 복잡한 JOIN을 View로 추상화
- 필드명 변경: `username` → `author_username` (더 명확한 네이밍)
- 성능: View를 통해 최적화된 쿼리 사용

## 적용 패턴

### 1. 레이아웃 Meta 함수 패턴

```typescript
// 레이아웃에서
export const meta: Route.MetaFunction = ({ data }) => {
  return [{ title: `${data.profile.name} | 앱이름` }];
};

// 하위 페이지에서는 meta 제거
```

### 2. 페이지 Loader 패턴

```typescript
export const loader = async ({ params }: Route.LoaderArgs) => {
  const items = await getItemsByUser(params.username);
  return { items };
};

export default function Page({ loaderData }: Route.ComponentProps) {
  const { items } = loaderData;
  // ...
}
```

### 3. View 활용 패턴

```typescript
// 복잡한 JOIN 대신 View 사용
.from("view_name")
.select("*")
.eq("field_name", value)
```

## 주의사항

1. **커뮤니티 기능 제외**: AI SaaS 프로젝트에서는 커뮤니티 포스트 기능이 필요 없을 수 있음
2. **프로젝트 중심**: 사용자의 공개 프로젝트를 보여주는 것이 더 적합할 수 있음
3. **View 의존성**: View가 존재해야 하므로 마이그레이션 순서 고려 필요

## 참고

- React Router `meta` 함수는 레이아웃과 페이지 모두에서 정의 가능
- 레이아웃의 `meta`가 우선순위가 높음
- `loaderData`를 통해 동적 메타 정보 생성 가능

