# 12.4 React Email

## 커밋 요약

Resend + React Email로 환영 메일을 전송하는 실험 라우트를 추가했습니다. 이메일 템플릿은 `react-email-starter` 하위 패키지에 모아두고, `/users/welcome` loader에서 Resend API를 호출해 JSX 템플릿을 그대로 전송합니다.

## 주요 변경사항

### 1. React Email 기반 환영 메일 전송

**구현**:
```tsx
// app/features/users/pages/welcome-page.tsx
import { Resend } from "resend";
import { render } from "@react-email/components";
import { WelcomeUser } from "react-email-starter/emails/welcome-user";
const client = new Resend(process.env.RESEND_API_KEY);

export const loader = async ({ params }: Route.LoaderArgs) => {
  const { data, error } = await client.emails.send({
    from: "Nico <nico@mail.wemake.cool>",
    to: ["nico@nomadcoders.co"],
    subject: "Welcome to Wemake.cool",
    react: <WelcomeUser username={"Resend"} />,
  });
  return Response.json({ data, error });
};
```

**패턴**:
- React Email 컴포넌트를 그대로 `react` 필드에 전달하면 Resend가 HTML로 렌더링
- API 키는 서버 환경 변수에서만 사용 (loader 실행 시점)
- loader 결과를 JSON으로 반환해 브라우저에서 전송 여부 확인

**장점**:
- 이메일 템플릿에 React 컴포넌트와 Tailwind를 활용 가능
- Resend SDK가 전송 상태/에러를 동시에 반환해 디버깅 용이

### 2. `/users/welcome` 라우트 등록

**변경**:
```ts
// app/routes.ts
route("/welcome", "features/users/pages/welcome-page.tsx"),
```

**패턴**:
- 기존 `/users/...` 네임스페이스 안에 테스트용 페이지 추가
- loader-only 페이지라 UI 없이 HTTP 호출로만 사용할 수도 있음

### 3. React Email Starter 패키지 추가

**구성**:
- `react-email-starter/` 하위에 독립 `package.json`, `emails/`, `static/`, `readme.md`
- Notion, Plaid, Stripe, Vercel 등 샘플 템플릿 포함 (`@react-email/components` 기반)
- `npm run dev`로 로컬 미리보기 서버 실행 가능 (port 3000)

**장점**:
- 이메일 템플릿 개발을 메인 앱과 분리해 의존성 충돌 방지
- 정적 자산(`static/*.png`)을 함께 관리해 미리보기와 전송 모두 동일 자산 사용

### 4. 의존성 업데이트

**추가**:
- `@react-email/components`, `resend`

**업데이트**:
- `react-router` → `^7.1.1` (라우터 전체 버전 정렬)

**의미**:
- React Email 컴포넌트 렌더링과 Resend API 호출에 필요한 런타임 확보
- 라우터 버전 통일로 `Route` 타입 import 충돌 방지

## 적용 방안

1. **환경 변수 세팅**  
   - `RESEND_API_KEY`를 `.env`와 호스팅 플랫폼 시크릿에 모두 등록해야 실제 전송 가능.

2. **템플릿 미리보기 워크플로우**  
   - `cd react-email-starter && npm install && npm run dev`로 브라우저 미리보기 → 템플릿 확정 후 메인 앱에서 import.

3. **테스트 대상 전환**  
   - 현재는 하드코딩된 수신자(`nico@nomadcoders.co`). Loader 파라미터나 Action 폼으로 전환하면 사용자별 메일 발송 처리 가능.

4. **전송 결과 로깅**  
   - Resend 응답(`data.id`, `error`)을 Supabase 로그 테이블에 기록하면 추후 실패 분석에 활용 가능.

