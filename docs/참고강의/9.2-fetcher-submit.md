# 9.2 fetcher Submit

## 커밋 요약

링크 전체를 `<Link>`로 감싼 카드 안에서 버튼만 분리해 서버 Action을 호출해야 할 때 `useFetcher`의 `submit` 메서드를 직접 사용하는 패턴입니다. `fetcher.Form`을 쓸 수 없을 때도 페이지 전환 없이 Action을 실행할 수 있도록 이벤트를 흡수하고 비동기 요청만 보냅니다.

## 주요 변경사항

### 1. 카드 컴포넌트에 `useFetcher` 주입

```tsx
import { Link, useFetcher } from "react-router";

const fetcher = useFetcher();
```

- 카드 전체를 `<Link>`로 둘러싼 상태라 별도 `<fetcher.Form>`을 만들기 어려운 상황에서 훅만 가져와 필요할 때 수동으로 `submit` 호출.
- `fetcher.state`를 활용하면 버튼 내부에서 로딩/완료 상태를 즉시 표현할 수 있는 준비가 됨.

### 2. 버튼 클릭 흡수 및 수동 `submit`

```tsx
const absorbClick = (e: React.MouseEvent<HTMLButtonElement>) => {
  e.preventDefault();
  fetcher.submit(
    { postId: id },
    {
      method: "POST",
      action: `/community/${id}/upvote`,
    }
  );
};
```

- `e.preventDefault()`로 `<Link>` 네비게이션을 막고 버튼 클릭이 카드 라우팅으로 이어지는 것을 차단.
- FormData 없이 객체만 넘겨도 내부에서 자동으로 FormData로 직렬화되어 Action으로 전송.
- 카드 내부에서 독립적인 CTA 버튼을 만들 때 재사용 가능한 패턴.

### 3. 버튼 UI 업데이트

```tsx
<Button onClick={absorbClick} variant="outline" className={cn("flex h-14", …)}>
  …
</Button>
```

- `<Button>`에 `onClick`만 연결해도 fetcher 기반 제출이 가능.
- 향후 `fetcher.state === "submitting"` 조건으로 비활성화/스피너를 붙일 수 있음.

### 4. Action 페이지 확인

```tsx
const postId = formData.get("postId");
console.log(postId, "fetcher submit says");
```

- fetcher 요청이 정상적으로 전달되는지 로그로 검증.
- 실제 구현에서는 여기서 인증/권한 체크 후 upvote를 처리.

## Projects 모듈 적용 아이디어

1. **카드 내부 CTA**  
   `app/features/projects`의 프로젝트 카드나 리스트에서 전체가 `<Link>`인 구성이라면, 카드 안 CTA 버튼에 동일한 `absorbClick + fetcher.submit` 패턴을 적용해 페이지 이동 없이 특정 Action만 호출할 수 있습니다.

2. **워크스페이스 즉시 작업**  
   `project-workspace-page.tsx`는 이미 여러 `useFetcher`를 사용하지만, 카드/패널 내 추가 버튼이 `<Link>`와 섞여 있는 곳에 이 패턴을 도입하면 사용자 흐름을 끊지 않고 서버 작업을 실행할 수 있습니다.

3. **로딩 상태 피드백**  
   `fetcher.state`를 버튼 텍스트나 `disabled` 속성에 연결하면, HITL 승인/재생성 요청 시 중복 클릭을 방지하고 명확한 피드백을 줄 수 있습니다.

원하면 위 아이디어를 실제 컴포넌트에 적용하는 작업안을 정리해 드리고, 승인 후 구현할 수 있습니다.
